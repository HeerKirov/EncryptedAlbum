<div id="mainView" class="panel" v-if="visible">
    <div style="overflow: auto; height: 100vh; width: 100%">
        <div style="margin-top: 72px; margin-bottom: 55px;">
            <ul style="margin: 0; padding: 0">
                <li v-for="(image, index) in showList" style="display: inline-block;" :style="{width: 60 + view.zoom * 40 + 'px'}">
                    <div class="card" style="margin: 2px">
                        <img class="card-img-top" :src="image.buffer" alt="Card image" style="width:100%" @click="selectOne(index, 'left')" @mouseup.right="selectOne(index, 'right')">
                        <div class="" v-if="view.showTitle">
                            <h6 class="m-2">{{image.title}}</h6>
                        </div>
                        <i v-if="image.selected" style="position: absolute; right: 5px; bottom: 5px;" class="fa fa-check-circle fa-2x text-primary"></i>
                        <i v-if="image.col" style="position: absolute; right: 5px; top: 5px;" class="fa fa-th-list fa-lg text-white"></i>
                    </div>
                </li>
            </ul>
            <button class="btn btn-block btn-link" v-if="canLoadFromBackend" @click="continueToPage">加载更多…</button>
        </div>
    </div>

    <nav id="navBar" class="navbar navbar-expand-sm fixed-top" style="height: 50px" :style="{'top': fullscreen ? '0' : '22px'}">
        <div class="ml-2" style="position: fixed; left: 0;">
            <button type="button" class="btn btn-sm btn-success" @click="add"><i class="fa fa-plus"></i></button>
        </div>
        <div class="mr-2" style="position: absolute; left: 42px">
          <button type="button" class="btn btn-sm" :class="{'btn-outline-secondary': !selected.mode, 'btn-secondary': selected.mode}" @click="switchSelectMode">
            <i class="fa fa-check-square-o"></i>
          </button>
        </div>
        <div style="position: absolute; left: 78px" v-if="viewFolder === 'list'">
            <div class="btn-group">
              <button type="button" class="btn btn-sm btn-outline-secondary" @click="loadOptionToSort" data-toggle="modal" data-target="#sortModal">
                <i class="fa fa-sort-amount-desc"></i>
              </button>
              <button type="button" class="btn btn-sm btn-outline-secondary" @click="loadOptionToFilter" data-toggle="modal" data-target="#filterModal">
                <i class="fa fa-filter"></i>
              </button>
              <input type="text" class="form-control rounded-0" v-model="searchTextInput" @keydown.enter="saveOptionFromSearch" style="width: 312px; height: 31px;">
              <button type="button" class="btn btn-sm btn-secondary" @click="saveOptionFromSearch"><i class="fa fa-search"></i></button>
            </div>
        </div>

        <div class="mr-2" style="position: absolute; right: 71px;">
          <div class="btn-group">
            <button type="button" class="btn btn-sm" :class="{'btn-secondary': viewFolder === 'list', 'btn-outline-secondary': viewFolder !== 'list'}" @click="switchList('list')">
              <div class="d-none d-md-block"><i class="fa fa-list"></i> 阅览列表</div>
              <div class="d-md-none"><i class="fa fa-list"></i></div>
            </button>
            <button type="button" class="btn btn-sm" :class="{'btn-secondary': viewFolder === 'temp', 'btn-outline-secondary': viewFolder !== 'temp'}" @click="switchList('temp')">
              <div class="d-none d-md-block"><i class="fa fa-folder-o"></i> 临时文件夹</div>
              <div class="d-md-none"><i class="fa fa-folder-o"></i></div>
            </button>
          </div>
        </div>
        <div class="mr-2" style="position: absolute; right: 35px">
          <button type="button" class="btn btn-sm btn-outline-secondary" @click="loadOptionToView" data-toggle="modal" data-target="#viewModal"><i class="fa fa-eye"></i></button>
        </div>
        <div class="mr-2" style="position: absolute; right: 0">
          <button type="button" class="btn btn-sm btn-outline-secondary"><i class="fa fa-cog"></i></button>
        </div>
    </nav>

    <div class="modal fade" id="viewModal">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">视图</h5>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-check">
              <label class="form-check-label">
                <input v-model="viewInput.aggregateByCollection" type="checkbox" class="form-check-input" value="">按照画集聚合显示
              </label>
            </div>
            <div class="form-check">
              <label class="form-check-label">
                <input v-model="viewInput.showTitle" type="checkbox" class="form-check-input" value="">显示标题
              </label>
            </div>
            <div class="row">
              <div class="col">
                <input v-model="viewInput.zoom" type="range" class="custom-range" min="1" max="10" step="1" value="5" style="height: 25px">
              </div>
              <div class="col-auto">
                <label>图片缩放</label>
              </div>
            </div>
              <div class="row">
                  <div class="col-auto">
                      一次加载数量
                  </div>
                  <div class="col">
                      <select class="form-control" v-model="viewInput.loadNum" style="height: 25px">
                          <option value="10">10</option>
                          <option value="20">20</option>
                          <option value="40">40</option>
                          <option value="80">80</option>
                          <option value="*">全部</option>
                      </select>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal" @click="saveOptionFromView">确定</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="sortModal">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">排序选项</h5>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <div class="radio">
              <label><input type="radio" name="sortRadio" v-model="sortInput.by" value="title">按标题排序</label>
            </div>
            <div class="radio">
              <label><input type="radio" name="sortRadio" v-model="sortInput.by" value="createTime">按创建时间排序</label>
            </div>
            <div class="radio">
              <label><input type="radio" name="sortRadio" v-model="sortInput.by" value="resolution">按大小排序</label>
            </div>
            <div class="form-check">
              <label class="form-check-label">
                <input v-model="sortInput.desc" type="checkbox" class="form-check-input" value="">降序
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal" @click="saveOptionFromSort">确定</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="filterModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">筛选选项</h5>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-auto"><label>收藏夹</label></div>
              <div class="col"><input v-model="filterInput.favorite" type="checkbox" class="form-check-input m-1" value=""></div>
            </div>
            <div class="row">
              <div class="col-auto"><label>标签组</label></div>
              <div class="col">
                  <div class="card">
                      <div class="card-body p-2">
                          <span v-if="filterInput.tags.length === 0" class="text-secondary">没有选择任何标签</span>
                          <span v-for="(tag, index) in filterInput.tags" class="badge m-1" :class="getTagType(tag, 'badge')">
                              <a class="text-white" @click="removeFilterTag(index)">{{getTagName(tag)}}</a>
                          </span>
                      </div>
                  </div>
                  <div class="btn-group mt-2 ml-1" v-if="filterInput.existTagsAll.length > 0">
                      <input type="text" placeholder="在标签中搜索" class="form-control rounded-0" v-model="filterInput.tagSearchText" @keydown.enter="searchFilterTags"/>
                      <button type="button" class="btn btn-secondary" @click="searchFilterTags">
                          <i class="fa fa-search"></i>
                      </button>
                  </div>
                  <div class="m-1 text-left" style="overflow: auto; max-height: 360px" v-if="filterInput.existTagsAll.length > 0">
                      <span v-for="tag in filterInput.existTags" class="badge m-1" :class="getTagType(tag, 'badge')">
                          <a class="text-white" @click="addFilterTag(tag)">{{getTagName(tag)}}</a>
                      </span>
                  </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal" @click="saveOptionFromFilter">确定</button>
          </div>
        </div>
      </div>
    </div>

    <div v-if="selected.mode" style="margin: auto; position: fixed; left:0; bottom:0; width: 620px;">
      <div class="card m-1 p-1">
        <div class="row">
          <div class="col">
            已选择<span class="badge badge-light">{{selected.count}}</span>项
          </div>
          <div class="col-auto">
            <div class="btn-group">
              <button type="button" class="btn btn-sm btn-outline-secondary" @click="selectAll">全选</button>
              <button type="button" class="btn btn-sm btn-outline-secondary" @click="selectNot">反选</button>
            </div>
          </div>
          <div class="col-auto">
            <div class="btn-group btn-group-sm">
              <button type="button" class="btn btn-sm btn-primary"
                      :class="{disabled: !leastSelectOne}" @click="selectToView">
                    <i class="fa fa-picture-o"></i> 预览
              </button>
              <button type="button" class="btn btn-sm btn-primary"
                      :class="{disabled: !leastSelectOne}" v-if="viewFolder === 'list'" @click="selectAddToTemp">
                  添加到临时文件夹
              </button>
              <button type="button" class="btn btn-sm btn-primary"
                      :class="{disabled: !leastSelectOne}" v-if="viewFolder === 'temp'" @click="selectRemoveFromTemp">
                  移出临时文件夹
              </button>
              <div class="btn-group">
                <button type="button" class="btn btn-sm btn-primary dropdown-toggle" :class="{disabled: !leastSelectOne}" data-toggle="dropdown">更多</button>
                <div class="dropdown-menu">
                  <a class="dropdown-item" @click="selectToExport">批量导出</a>
                  <a class="dropdown-item" data-toggle="modal" data-target="#deleteAllCheck">批量删除</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="deleteAllCheck">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">警告</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    确认要删除吗？该操作不可逆。
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal" @click="selectToDelete">确定</button>
                    <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exportAllCheck">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">导出确认</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="row p-1">
                        <div class="col-auto">导出位置</div>
                        <div class="col">{{exportPanel.path}}</div>
                    </div>
                    <div class="row p-1">
                        <div class="col-auto">导出类型</div>
                        <div class="col">
                            <select class="form-control" v-model="exportPanel.ext">
                                <option value="jpg">JPEG</option>
                                <option value="png">PNG</option>
                            </select>
                        </div>
                    </div>
                    <div class="row p-1">
                        <div class="col-auto">文件一览</div>
                        <div class="col">
                            <div class="card p-1" style="overflow: auto; max-height: 360px; width: 100%">
                                <table>
                                    <tbody>
                                        <tr v-for="item in exportPanel.items"><td>{{item.title}}</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-success" data-dismiss="modal" @click="selectToExportOk"><i class="fa fa-upload"></i> 导出</button>
                </div>
            </div>
        </div>
    </div>
</div>